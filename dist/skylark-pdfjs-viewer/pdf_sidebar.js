/**
 * skylark-pdfjs-viewer - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./ui_utils","./pdf_rendering_queue"],function(t,i){const{NullL10n:e,PresentationModeState:s,SidebarView:n}=t,{RenderingStates:h}=i,a="pdfSidebarNotification";return{PDFSidebar:class{constructor({elements:t,pdfViewer:i,pdfThumbnailViewer:s,eventBus:h,l10n:a=e}){this.isOpen=!1,this.active=n.THUMBS,this.isInitialViewSet=!1,this.onToggled=null,this.pdfViewer=i,this.pdfThumbnailViewer=s,this.outerContainer=t.outerContainer,this.viewerContainer=t.viewerContainer,this.toggleButton=t.toggleButton,this.thumbnailButton=t.thumbnailButton,this.outlineButton=t.outlineButton,this.attachmentsButton=t.attachmentsButton,this.layersButton=t.layersButton,this.thumbnailView=t.thumbnailView,this.outlineView=t.outlineView,this.attachmentsView=t.attachmentsView,this.layersView=t.layersView,this._outlineOptionsContainer=t.outlineOptionsContainer,this._currentOutlineItemButton=t.currentOutlineItemButton,this.eventBus=h,this.l10n=a,this._addEventListeners()}reset(){this.isInitialViewSet=!1,this._hideUINotification(!0),this.switchView(n.THUMBS),this.outlineButton.disabled=!1,this.attachmentsButton.disabled=!1,this.layersButton.disabled=!1,this._currentOutlineItemButton.disabled=!0}get visibleView(){return this.isOpen?this.active:n.NONE}get isThumbnailViewVisible(){return this.isOpen&&this.active===n.THUMBS}get isOutlineViewVisible(){return this.isOpen&&this.active===n.OUTLINE}get isAttachmentsViewVisible(){return this.isOpen&&this.active===n.ATTACHMENTS}get isLayersViewVisible(){return this.isOpen&&this.active===n.LAYERS}setInitialView(t=n.NONE){this.isInitialViewSet||(this.isInitialViewSet=!0,t!==n.NONE&&t!==n.UNKNOWN&&this._switchView(t,!0)||this._dispatchEvent())}switchView(t,i=!1){this._switchView(t,i)}_switchView(t,i=!1){const e=t!==this.active;let s=!1;switch(t){case n.NONE:return!!this.isOpen&&(this.close(),!0);case n.THUMBS:this.isOpen&&e&&(s=!0);break;case n.OUTLINE:if(this.outlineButton.disabled)return!1;break;case n.ATTACHMENTS:if(this.attachmentsButton.disabled)return!1;break;case n.LAYERS:if(this.layersButton.disabled)return!1;break;default:return console.error(`PDFSidebar._switchView: "${t}" is not a valid view.`),!1}return this.active=t,this.thumbnailButton.classList.toggle("toggled",t===n.THUMBS),this.outlineButton.classList.toggle("toggled",t===n.OUTLINE),this.attachmentsButton.classList.toggle("toggled",t===n.ATTACHMENTS),this.layersButton.classList.toggle("toggled",t===n.LAYERS),this.thumbnailView.classList.toggle("hidden",t!==n.THUMBS),this.outlineView.classList.toggle("hidden",t!==n.OUTLINE),this.attachmentsView.classList.toggle("hidden",t!==n.ATTACHMENTS),this.layersView.classList.toggle("hidden",t!==n.LAYERS),this._outlineOptionsContainer.classList.toggle("hidden",t!==n.OUTLINE),i&&!this.isOpen?(this.open(),!0):(s&&(this._updateThumbnailViewer(),this._forceRendering()),e&&this._dispatchEvent(),e)}open(){this.isOpen||(this.isOpen=!0,this.toggleButton.classList.add("toggled"),this.outerContainer.classList.add("sidebarMoving","sidebarOpen"),this.active===n.THUMBS&&this._updateThumbnailViewer(),this._forceRendering(),this._dispatchEvent(),this._hideUINotification())}close(){this.isOpen&&(this.isOpen=!1,this.toggleButton.classList.remove("toggled"),this.outerContainer.classList.add("sidebarMoving"),this.outerContainer.classList.remove("sidebarOpen"),this._forceRendering(),this._dispatchEvent())}toggle(){this.isOpen?this.close():this.open()}_dispatchEvent(){this.eventBus.dispatch("sidebarviewchanged",{source:this,view:this.visibleView})}_forceRendering(){this.onToggled?this.onToggled():(this.pdfViewer.forceRendering(),this.pdfThumbnailViewer.forceRendering())}_updateThumbnailViewer(){const{pdfViewer:t,pdfThumbnailViewer:i}=this,e=t.pagesCount;for(let s=0;s<e;s++){const e=t.getPageView(s);e&&e.renderingState===h.FINISHED&&i.getThumbnail(s).setImage(e)}i.scrollThumbnailIntoView(t.currentPageNumber)}_showUINotification(){this.l10n.get("toggle_sidebar_notification2.title",null,"Toggle Sidebar (document contains outline/attachments/layers)").then(t=>{this.toggleButton.title=t}),this.isOpen||this.toggleButton.classList.add(a)}_hideUINotification(t=!1){(this.isOpen||t)&&this.toggleButton.classList.remove(a),t&&this.l10n.get("toggle_sidebar.title",null,"Toggle Sidebar").then(t=>{this.toggleButton.title=t})}_addEventListeners(){this.viewerContainer.addEventListener("transitionend",t=>{t.target===this.viewerContainer&&this.outerContainer.classList.remove("sidebarMoving")}),this.toggleButton.addEventListener("click",()=>{this.toggle()}),this.thumbnailButton.addEventListener("click",()=>{this.switchView(n.THUMBS)}),this.outlineButton.addEventListener("click",()=>{this.switchView(n.OUTLINE)}),this.outlineButton.addEventListener("dblclick",()=>{this.eventBus.dispatch("toggleoutlinetree",{source:this})}),this.attachmentsButton.addEventListener("click",()=>{this.switchView(n.ATTACHMENTS)}),this.layersButton.addEventListener("click",()=>{this.switchView(n.LAYERS)}),this.layersButton.addEventListener("dblclick",()=>{this.eventBus.dispatch("resetlayers",{source:this})}),this._currentOutlineItemButton.addEventListener("click",()=>{this.eventBus.dispatch("currentoutlineitem",{source:this})});const t=(t,i,e)=>{i.disabled=!t,t?this._showUINotification():this.active===e&&this.switchView(n.THUMBS)};this.eventBus._on("outlineloaded",i=>{t(i.outlineCount,this.outlineButton,n.OUTLINE),i.enableCurrentOutlineItemButton&&this.pdfViewer.pagesPromise.then(()=>{this._currentOutlineItemButton.disabled=!this.isInitialViewSet})}),this.eventBus._on("attachmentsloaded",i=>{t(i.attachmentsCount,this.attachmentsButton,n.ATTACHMENTS)}),this.eventBus._on("layersloaded",i=>{t(i.layersCount,this.layersButton,n.LAYERS)}),this.eventBus._on("presentationmodechanged",t=>{t.state===s.NORMAL&&this.isThumbnailViewVisible&&this._updateThumbnailViewer()})}}}});
//# sourceMappingURL=sourcemaps/pdf_sidebar.js.map
