/**
 * skylark-pdfjs-viewer - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-pdfjs-display","./ui_utils"],function(e,t){const{createPromiseCapability:i,PDFDateString:a}=e,{getPageSizeInches:n,getPDFFileNameFromURL:s,isPortraitOrientation:r,NullL10n:o}=t,h="-",l=["en-us","en-lr","my"],c={"8.5x11":"Letter","8.5x14":"Legal"},d={"297x420":"A3","210x297":"A4"};function g(e,t,i){return i[`${t?e.width:e.height}x${t?e.height:e.width}`]}return{PDFDocumentProperties:class{constructor({overlayName:e,fields:t,container:i,closeButton:a},n,s,r=o){this.overlayName=e,this.fields=t,this.container=i,this.overlayManager=n,this.l10n=r,this._reset(),a.addEventListener("click",this.close.bind(this)),this.overlayManager.register(this.overlayName,this.container,this.close.bind(this)),s._on("pagechanging",e=>{this._currentPageNumber=e.pageNumber}),s._on("rotationchanging",e=>{this._pagesRotation=e.pagesRotation}),this._isNonMetricLocale=!0,r.getLanguage().then(e=>{this._isNonMetricLocale=l.includes(e)})}async open(){const e=e=>{Object.defineProperty(this,"fieldData",{value:Object.freeze(e),writable:!1,enumerable:!0,configurable:!0})};await Promise.all([this.overlayManager.open(this.overlayName),this._dataAvailableCapability.promise]);const t=this._currentPageNumber,i=this._pagesRotation;if(this.fieldData&&t===this.fieldData._currentPageNumber&&i===this.fieldData._pagesRotation)return void this._updateUI();const{info:a,contentDispositionFilename:r,contentLength:o}=await this.pdfDocument.getMetadata(),[h,l,c,d,g,u]=await Promise.all([r||s(this.url),this._parseFileSize(o),this._parseDate(a.CreationDate),this._parseDate(a.ModDate),this.pdfDocument.getPage(t).then(e=>this._parsePageSize(n(e),i)),this._parseLinearization(a.IsLinearized)]);e({fileName:h,fileSize:l,title:a.Title,author:a.Author,subject:a.Subject,keywords:a.Keywords,creationDate:c,modificationDate:d,creator:a.Creator,producer:a.Producer,version:a.PDFFormatVersion,pageCount:this.pdfDocument.numPages,pageSize:g,linearized:u,_currentPageNumber:t,_pagesRotation:i}),this._updateUI();const{length:_}=await this.pdfDocument.getDownloadInfo();if(o===_)return;const p=Object.assign(Object.create(null),this.fieldData);p.fileSize=await this._parseFileSize(_),e(p),this._updateUI()}close(){this.overlayManager.close(this.overlayName)}setDocument(e,t=null){this.pdfDocument&&(this._reset(),this._updateUI(!0)),e&&(this.pdfDocument=e,this.url=t,this._dataAvailableCapability.resolve())}_reset(){this.pdfDocument=null,this.url=null,delete this.fieldData,this._dataAvailableCapability=i(),this._currentPageNumber=1,this._pagesRotation=0}_updateUI(e=!1){if(!e&&this.fieldData){if(this.overlayManager.active===this.overlayName)for(const e in this.fields){const t=this.fieldData[e];this.fields[e].textContent=t||0===t?t:h}}else for(const e in this.fields)this.fields[e].textContent=h}async _parseFileSize(e=0){const t=e/1024;if(t)return t<1024?this.l10n.get("document_properties_kb",{size_kb:(+t.toPrecision(3)).toLocaleString(),size_b:e.toLocaleString()},"{{size_kb}} KB ({{size_b}} bytes)"):this.l10n.get("document_properties_mb",{size_mb:(+(t/1024).toPrecision(3)).toLocaleString(),size_b:e.toLocaleString()},"{{size_mb}} MB ({{size_b}} bytes)")}async _parsePageSize(e,t){if(!e)return;t%180!=0&&(e={width:e.height,height:e.width});const i=r(e);let a={width:Math.round(100*e.width)/100,height:Math.round(100*e.height)/100},n={width:Math.round(25.4*e.width*10)/10,height:Math.round(25.4*e.height*10)/10},s=null,o=g(a,i,c)||g(n,i,d);if(!(o||Number.isInteger(n.width)&&Number.isInteger(n.height))){const t={width:25.4*e.width,height:25.4*e.height},s={width:Math.round(n.width),height:Math.round(n.height)};Math.abs(t.width-s.width)<.1&&Math.abs(t.height-s.height)<.1&&(o=g(s,i,d))&&(a={width:Math.round(s.width/25.4*100)/100,height:Math.round(s.height/25.4*100)/100},n=s)}return o&&(s=this.l10n.get("document_properties_page_size_name_"+o.toLowerCase(),null,o)),Promise.all([this._isNonMetricLocale?a:n,this.l10n.get("document_properties_page_size_unit_"+(this._isNonMetricLocale?"inches":"millimeters"),null,this._isNonMetricLocale?"in":"mm"),s,this.l10n.get("document_properties_page_size_orientation_"+(i?"portrait":"landscape"),null,i?"portrait":"landscape")]).then(([{width:e,height:t},i,a,n])=>this.l10n.get("document_properties_page_size_dimension_"+(a?"name_":"")+"string",{width:e.toLocaleString(),height:t.toLocaleString(),unit:i,name:a,orientation:n},"{{width}} Ã— {{height}} {{unit}} ("+(a?"{{name}}, ":"")+"{{orientation}})"))}async _parseDate(e){const t=a.toDateObject(e);if(t)return this.l10n.get("document_properties_date_string",{date:t.toLocaleDateString(),time:t.toLocaleTimeString()},"{{date}}, {{time}}")}_parseLinearization(e){return this.l10n.get("document_properties_linearized_"+(e?"yes":"no"),null,e?"Yes":"No")}}}});
//# sourceMappingURL=sourcemaps/pdf_document_properties.js.map
