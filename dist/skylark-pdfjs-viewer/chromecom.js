/**
 * skylark-pdfjs-viewer - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./pdfjs_dev","./app","./app_options","./download_manager","./genericl10n","./generic_scripting"],function(e,n,t,o,r,i){const{DefaultExternalServices:c,PDFViewerApplication:s}=n,{AppOptions:a}=t,{BasePreferences:l}=preferences,{DownloadManager:d}=o,{GenericL10n:u}=r,{GenericScripting:m}=i;if(void 0===e||!e.test("CHROME"))throw new Error('Module "pdfjs-web/chromecom" shall not be used outside CHROME build.');const f={request(e,n,t){const o={action:e,data:n};chrome.runtime?t?chrome.runtime.sendMessage(o,t):chrome.runtime.sendMessage(o):(console.error("chrome.runtime is undefined."),t&&t())},resolvePDFFile(n,t,o){n=n.replace(/^drive:/i,"filesystem:"+location.origin+"/external/"),/^https?:/.test(n)?function(e,n){p||(p=chrome.runtime.connect({name:"chromecom-referrer"}));function t(e){if(e){const n=window.history.state||{};n.chromecomState=e,window.history.replaceState(n,"")}p.onDisconnect.removeListener(o),p.onMessage.removeListener(t),n()}function o(){p=null,n()}p.onDisconnect.addListener(o),p.onMessage.addListener(t),p.postMessage({referer:window.history.state&&window.history.state.chromecomState,requestUrl:e})}(n,function(){o(n)}):/^file?:/.test(n)?function(e){const n=window===top?location.origin:location.ancestorOrigins[0];"null"===n?function(e){f.request("getParentOrigin",null,e)}(e):e(n)}(function(r){!r||/^file:|^chrome-extension:/.test(r)?function(e){f.request("isAllowedFileSchemeAccess",null,e)}(function(r){r?o(n):function(n,t,o){let r=null;top!==window&&(window.addEventListener("focus",g),r=function(){window.removeEventListener("focus",g),g(),t.close("chromeFileAccessOverlay")});w||(w=t.register("chromeFileAccessOverlay",document.getElementById("chromeFileAccessOverlay"),r,!0));w.then(function(){const r=chrome.runtime.getManifest().icons[48];document.getElementById("chrome-pdfjs-logo-bg").style.backgroundImage="url("+chrome.runtime.getURL(r)+")";const i=e.json("$ROOT/web/chrome-i18n-allow-access-to-file-urls.json")[chrome.i18n.getUILanguage&&chrome.i18n.getUILanguage()];i&&(document.getElementById("chrome-file-access-label").textContent=i);const c=document.getElementById("chrome-link-to-extensions-page");c.href="chrome://extensions/?id="+chrome.runtime.id,c.onclick=function(e){e.preventDefault(),f.request("openExtensionsPageForFileAccess",{newTab:e.ctrlKey||e.metaKey||1===e.button||window!==top})},document.getElementById("chrome-url-of-local-file").textContent=n,document.getElementById("chrome-file-fallback").onchange=function(){const e=this.files[0];if(e){const r=decodeURIComponent(n.split("/").pop());let i=n;if(r!==e.name){const n="The selected file does not match the original file.\nOriginal: "+r+"\nSelected: "+e.name+"\nDo you want to open the selected file?";if(!confirm(n))return void(this.value="");i="file:///fakepath/to/"+encodeURIComponent(e.name)}o(URL.createObjectURL(e),e.size,i),t.close("chromeFileAccessOverlay")}},t.open("chromeFileAccessOverlay")})}(n,t,o)}):s.error("Blocked "+r+" from loading "+n+". Refused to load a local file in a non-local page for security reasons.")}):o(n)}};function h(){try{if(chrome.runtime&&chrome.runtime.getManifest())return!0}catch(e){}return!1}function g(){h()||location.reload()}let w,p;window===top&&addEventListener("unload",function(){h()||localStorage.setItem("unload-"+Date.now()+"-"+document.hidden+"-"+location.href,JSON.stringify(history.state))});const y=chrome.storage.sync||chrome.storage.local;class L extends l{async _writeToStorage(e){return new Promise(n=>{if(e===this.defaults){const e=Object.keys(this.defaults);y.remove(e,function(){n()})}else y.set(e,function(){n()})})}async _readFromStorage(e){return new Promise(e=>{const n=n=>{chrome.runtime.lastError&&(n=this.defaults),y.get(n,function(n){e(n)})};if(chrome.storage.managed){const e=Object.assign({enableHandToolOnLoad:!1,disableTextLayer:!1,enhanceTextSelection:!1,showPreviousViewOnLoad:!0,disablePageMode:!1},this.defaults);chrome.storage.managed.get(e,function(t){(t=t||e).enableHandToolOnLoad&&!t.cursorToolOnLoad&&(t.cursorToolOnLoad=1),delete t.enableHandToolOnLoad,1!==t.textLayerMode&&(t.disableTextLayer?t.textLayerMode=0:t.enhanceTextSelection&&(t.textLayerMode=2)),delete t.disableTextLayer,delete t.enhanceTextSelection,t.showPreviousViewOnLoad||t.viewOnLoad||(t.viewOnLoad=1),delete t.showPreviousViewOnLoad,delete t.disablePageMode,n(t)})}else n(this.defaults)})}}return s.externalServices=class extends c{static initPassiveLoading(e){f.resolvePDFFile(a.get("defaultUrl"),s.overlayManager,function(n,t,o){e.onOpenWithURL(n,t,o)})}static createDownloadManager(e){return new d}static createPreferences(){return new L}static createL10n(e){return new u(navigator.language)}static createScripting({sandboxBundleSrc:e}){return new m(e)}},{ChromeCom:f}});
//# sourceMappingURL=sourcemaps/chromecom.js.map
